/**
 * 
 * 
 * @Author: Sam Wheeler, 2013 
 * 
 * 
 */
Ext.define("Ext.ux.FilterField",{extend:"Ext.container.Container",alias:"widget.filterfield",emptyText:"Filter...",buttons:true,border:false,grid:null,filterOnType:false,doFilter:function(e){var d=this.grid||this.up("grid");var b=d.getStore();e=e.toLowerCase();if(!e){b.clearFilter();this.fireEvent("unfilter",this,e,b);return false}e=(e.split(", ").length!=1)?e.split(", "):e.split(",");var c=d.getView().getHeaderCt().getVisibleGridColumns();var a=[];Ext.each(c,function(f){a.push(f.dataIndex)});b.clearFilter();b.filterBy(function(f){var g=0;Ext.each(e,function(i,h){Ext.each(a,function(j){f.get(j).toLowerCase().indexOf(i)!==-1&&g++})});return(g==e.length)?true:false});this.fireEvent("filter",this,e,b)},layout:{type:"hbox",align:"stretch"},flex:1,afterFirstLayout:function(){var a=this;a.callParent(arguments);a.add(Ext.create("Ext.form.field.Text",{emptyText:a.emptyText,flex:1,grow:true,listeners:{specialkey:function(c,b){if(b.getKey()==b.ENTER&&!c.up("container").filterOnType){a.doFilter(c.getValue())}},change:function(c,b){if(!b){a.doFilter(c.getValue());Ext.each(a.query("button"),function(d){d.setDisabled(true)});return false}else{a.filterOnType&&a.doFilter(c.getValue());Ext.each(a.query("button"),function(d){d.setDisabled(false)})}}}}));if(a.buttons){a.add([{xtype:"button",icon:"resources/img/icons/magnifier.png",disabled:true,margin:"0 0 0 2",handler:function(){this.up("container").doFilter(this.up("container").down("textfield").getValue())}},{xtype:"button",icon:"resources/img/icons/cross-script.png",disabled:true,margin:"0 0 0 2",handler:function(){this.up("container").down("textfield").setValue("")}}])}},setValue:function(a){this.down("textfield").setValue(a)},getValue:function(){return this.down("textfield").getValue()}});